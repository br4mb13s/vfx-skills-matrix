<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VFX Studio Skills Assessment System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2E86AB, #A23B72);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .header {
            background: linear-gradient(135deg, #2E86AB, #A23B72);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .btn.active {
            background: rgba(255,255,255,0.4);
            border-color: rgba(255,255,255,0.6);
        }

        .btn.supervisor-only {
            display: inline-block;
            opacity: 0.8;
        }

        .btn.supervisor-only.visible {
            display: inline-block;
            opacity: 1;
        }

        .view {
            display: none;
            padding: 30px;
        }

        .view.active {
            display: block;
        }

        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .employee-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
        }

        .employee-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: #2E86AB;
        }

        .employee-name {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .employee-role {
            color: #6c757d;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .completion-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            display: inline-block;
        }

        .completed {
            background: #d4edda;
            color: #155724;
        }

        .pending {
            background: #fff3cd;
            color: #856404;
        }

        .not-started {
            background: #f8d7da;
            color: #721c24;
        }

        .needs-review {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .assessment-form {
            max-width: 900px;
            margin: 0 auto;
        }

        .skills-section {
            margin-bottom: 40px;
        }

        .section-title {
            background: #2E86AB;
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            font-size: 1.2em;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-type {
            font-size: 0.8em;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 12px;
        }

        .skills-grid {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 8px 8px;
        }

        .skill-row {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            position: relative;
        }

        .skill-row:last-child {
            border-bottom: none;
        }

        .skill-name {
            flex: 1;
            font-weight: 500;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .skill-dependencies {
            font-size: 0.8em;
            color: #6c757d;
            font-style: italic;
        }

        .rating-buttons {
            display: flex;
            gap: 8px;
            position: relative;
        }

        .rating-btn {
            padding: 8px 16px;
            border: 3px solid transparent;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 700;
            transition: all 0.3s ease;
            background: #e9ecef;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 80px;
            text-align: center;
            opacity: 0.4;
            position: relative;
        }

        .rating-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0.7;
        }

        .rating-btn.selected {
            border-color: currentColor;
            transform: scale(1.12);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            position: relative;
            opacity: 1;
        }

        .rating-btn.selected::after {
            content: '✓';
            position: absolute;
            top: -8px;
            right: -8px;
            background: white;
            color: inherit;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            border: 2px solid currentColor;
        }

        .skill-row:hover .rating-btn:not(.selected) {
            opacity: 0.8;
        }

        .rating-btn.expert { 
            background: linear-gradient(135deg, #2E86AB, #4a9bc7); 
            color: white; 
        }
        
        .rating-btn.expert.selected { 
            background: linear-gradient(135deg, #236b8a, #3a7ba3);
            box-shadow: 0 6px 20px rgba(46, 134, 171, 0.4);
        }
        
        .rating-btn.advanced { 
            background: linear-gradient(135deg, #A23B72, #c4598a); 
            color: white; 
        }
        
        .rating-btn.advanced.selected { 
            background: linear-gradient(135deg, #812e5a, #9d4e7a);
            box-shadow: 0 6px 20px rgba(162, 59, 114, 0.4);
        }
        
        .rating-btn.intermediate { 
            background: linear-gradient(135deg, #CA653A, #df7d56); 
            color: white; 
        }
        
        .rating-btn.intermediate.selected { 
            background: linear-gradient(135deg, #a5512e, #c16442);
            box-shadow: 0 6px 20px rgba(202, 101, 58, 0.4);
        }
        
        .rating-btn.beginner { 
            background: linear-gradient(135deg, #F18F01, #f4a434); 
            color: white; 
        }
        
        .rating-btn.beginner.selected { 
            background: linear-gradient(135deg, #c17201, #d67e0d);
            box-shadow: 0 6px 20px rgba(241, 143, 1, 0.4);
        }

        .rating-btn.none { 
            background: linear-gradient(135deg, #6c757d, #868e96); 
            color: white; 
        }
        
        .rating-btn.none.selected { 
            background: linear-gradient(135deg, #5a6268, #6c757d);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        .comment-section {
            margin-top: 10px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .comment-section.active {
            display: block;
        }

        .comment-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            min-height: 60px;
        }

        .comment-toggle {
            font-size: 0.85em;
            color: #007bff;
            cursor: pointer;
            text-decoration: underline;
            margin-left: 10px;
        }

        .training-checkbox {
            margin-left: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
            color: #495057;
        }

        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #2E86AB, #A23B72);
            height: 100%;
            transition: width 0.3s ease;
        }

        .save-btn {
            background: linear-gradient(135deg, #2E86AB, #A23B72);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(46, 134, 171, 0.3);
        }

        .save-btn:hover {
            background: linear-gradient(135deg, #236b8a, #812e5a);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 134, 171, 0.4);
        }

        .overview-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .overview-table th,
        .overview-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }

        .overview-table th {
            background: #2E86AB;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .overview-table th:first-child {
            text-align: left;
            position: sticky;
            left: 0;
            z-index: 11;
            background: #A23B72;
        }

        .overview-table td:first-child {
            background: #f8f9fa;
            font-weight: 600;
            text-align: left;
            position: sticky;
            left: 0;
            z-index: 9;
            min-width: 200px;
        }

        .skill-rating {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .expert { background: #2E86AB; color: white; }
        .advanced { background: #A23B72; color: white; }
        .intermediate { background: #CA653A; color: white; }
        .beginner { background: #F18F01; color: white; }
        .none { background: #6c757d; color: white; }
        .not-assessed { background: #6c757d; color: white; }

        .filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 12px;
            font-weight: 600;
            color: #495057;
        }

        select, input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
        }

        .export-btn {
            background: linear-gradient(135deg, #CA653A, #F18F01);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(202, 101, 58, 0.3);
        }

        .export-btn:hover {
            background: linear-gradient(135deg, #a5512e, #c17201);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(202, 101, 58, 0.4);
        }

        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .password-modal {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .password-modal h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .password-modal input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
        }

        .password-modal input:focus {
            outline: none;
            border-color: #2E86AB;
            box-shadow: 0 0 0 3px rgba(46, 134, 171, 0.1);
        }

        .password-modal .btn {
            background: linear-gradient(135deg, #2E86AB, #A23B72);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 0 10px;
        }

        .password-modal .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 134, 171, 0.3);
        }

        .password-hint {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.95em;
            color: #495057;
        }

        .auto-save-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(40, 167, 69, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        .session-info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(46, 134, 171, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .analytics-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #2E86AB;
        }

        .analytics-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .analytics-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2E86AB;
            margin-bottom: 5px;
        }

        .analytics-label {
            color: #6c757d;
            font-size: 0.9em;
        }

        .add-employee-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px dashed #2E86AB;
        }

        .add-employee-form {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select {
            padding: 10px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            min-width: 150px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2E86AB;
            box-shadow: 0 0 0 3px rgba(46, 134, 171, 0.1);
        }

        .add-btn {
            background: linear-gradient(135deg, #2E86AB, #A23B72);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            height: fit-content;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 134, 171, 0.3);
        }

        /* Skill Level Info Styles */
        .skill-info-btn {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6c757d;
            color: white;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.2s ease;
        }

        .skill-info-btn:hover {
            background: #2E86AB;
            transform: scale(1.1);
        }

        .skill-definitions-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 2001;
        }

        .skill-definitions-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
        }

        .skill-definition {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid;
        }

        .skill-definition.expert {
            background: rgba(46, 134, 171, 0.1);
            border-left-color: #2E86AB;
        }

        .skill-definition.advanced {
            background: rgba(162, 59, 114, 0.1);
            border-left-color: #A23B72;
        }

        .skill-definition.intermediate {
            background: rgba(202, 101, 58, 0.1);
            border-left-color: #CA653A;
        }

        .skill-definition.beginner {
            background: rgba(241, 143, 1, 0.1);
            border-left-color: #F18F01;
        }

        .skill-definition.none {
            background: rgba(108, 117, 125, 0.1);
            border-left-color: #6c757d;
        }

        .skill-definition h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .skill-definition p {
            color: #495057;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .skill-definition .context-label {
            font-weight: 600;
            color: #2E86AB;
            margin-right: 5px;
        }

        .inline-help {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 100;
            margin-bottom: 5px;
            max-width: 200px;
            white-space: normal;
            text-align: center;
        }

        .inline-help::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #2c3e50;
        }

        .rating-btn:hover .inline-help {
            opacity: 1;
            visibility: visible;
        }

        /* Skill Coverage Visualization */
        .coverage-chart {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .coverage-bar {
            display: flex;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .coverage-segment {
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            font-weight: 600;
        }

        /* Quick Actions */
        .quick-actions {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            background: white;
            border: 2px solid #dee2e6;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            color: #495057;
        }

        .quick-action-btn:hover {
            background: #2E86AB;
            color: white;
            border-color: #2E86AB;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 134, 171, 0.3);
        }

        /* Progress History */
        .progress-history {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .history-item {
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-date {
            font-weight: 600;
            color: #2c3e50;
        }

        .history-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
        }

        .change-positive {
            color: #28a745;
        }

        .change-negative {
            color: #dc3545;
        }

        /* Role Requirements */
        .role-requirements {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .requirement-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .requirement-met {
            color: #28a745;
        }

        .requirement-not-met {
            color: #dc3545;
        }

        /* Error Messages */
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #dc3545;
        }

        /* Success Messages */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }

        /* Learning Path */
        .learning-path {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .path-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px 0;
        }

        .path-arrow {
            color: #2196f3;
            font-size: 1.2em;
        }

        /* Swipeable rating for mobile */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .employee-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .rating-buttons {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scroll-snap-type: x mandatory;
                gap: 5px;
            }
            
            .rating-btn {
                scroll-snap-align: center;
                min-width: 70px;
                font-size: 0.85em;
                padding: 6px 12px;
            }
            
            .overview-table {
                font-size: 12px;
            }
            
            .overview-table th,
            .overview-table td {
                padding: 8px 4px;
            }
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Backup/Restore Section */
        .backup-section {
            background: #e8f4f8;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #bee5eb;
        }

        .backup-info {
            font-size: 0.9em;
            color: #0c5460;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <h1>VFX Studio Skills Assessment</h1>
                <p>Comprehensive skills tracking and development system</p>
                <div class="nav-buttons">
                    <button class="btn active" onclick="showView('home')">Home</button>
                    <button class="btn" onclick="showView('assessment')">Self Assessment</button>
                    <button class="btn supervisor-only" onclick="requestSupervisorAccess()">Supervisor Overview</button>
                    <button class="btn" onclick="showView('progress')">My Progress</button>
                    <button class="btn" onclick="showView('learningPaths')">Learning Paths</button>
                </div>
            </div>

            <!-- Home View -->
            <div id="home" class="view active">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Select Your Assessment</h2>
                <div class="employee-grid" id="employeeGrid">
                    <div style="text-align: center; padding: 40px; color: #6c757d;">
                        <h3>Loading team members...</h3>
                        <p>Please wait while we load the employee list.</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 40px; padding: 30px; background: #f8f9fa; border-radius: 12px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">Instructions</h3>
                    <p style="color: #6c757d; line-height: 1.6; max-width: 600px; margin: 0 auto;">
                        Click on your name above to complete your skills assessment. Your responses are private and only visible to supervisors in the overview. 
                        Be honest about your current skill levels - this helps identify training opportunities and project assignments.
                    </p>
                </div>
            </div>

            <!-- Assessment View -->
            <div id="assessment" class="view">
                <div class="assessment-form">
                    <h2 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">Skills Assessment</h2>
                    <div id="currentEmployee" style="text-align: center; margin-bottom: 30px; font-size: 1.2em; color: #6c757d;">
                        <span id="employeeNameRole"></span>
                        <span class="skill-info-btn" onclick="showSkillDefinitions()">?</span>
                    </div>
                    
                    <div id="roleRequirements" class="role-requirements" style="display: none;">
                        <h4 style="margin-bottom: 10px;">Role Requirements</h4>
                        <div id="requirementsList"></div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div style="text-align: center; margin-bottom: 30px; color: #6c757d;">
                        <span id="progressText">0% Complete</span>
                    </div>

                    <div id="skillsSections">
                        <!-- Skills sections will be populated by JavaScript -->
                    </div>

                    <div style="text-align: center;">
                        <button class="save-btn" onclick="saveAssessment()">Save Assessment</button>
                        <button class="btn" onclick="showView('home')" style="margin-left: 15px; background: #6c757d;">Back to Home</button>
                    </div>
                </div>
            </div>

            <!-- Progress View -->
            <div id="progress" class="view">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">My Progress</h2>
                
                <div id="progressContent">
                    <p style="text-align: center; color: #6c757d;">Please log in to view your progress history.</p>
                </div>
            </div>

            <!-- Learning Paths View -->
            <div id="learningPaths" class="view">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Recommended Learning Paths</h2>
                
                <div id="learningPathsContent">
                    <p style="text-align: center; color: #6c757d;">Please complete an assessment to see personalized learning recommendations.</p>
                </div>
            </div>

            <!-- Overview View -->
            <div id="overview" class="view">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Supervisor Overview</h2>
                
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="reviewPendingAssessments()">Review Pending</button>
                    <button class="quick-action-btn" onclick="setTeamGoals()">Set Team Goals</button>
                    <button class="quick-action-btn" onclick="scheduleReassessment()">Schedule Reassessment</button>
                    <button class="quick-action-btn" onclick="exportDepartmentReport()">Department Report</button>
                    <button class="quick-action-btn" onclick="backupAllData()">Backup All Data</button>
                    <button class="quick-action-btn" onclick="document.getElementById('restoreFile').click()">Restore Backup</button>
                    <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreBackup(event)">
                </div>
                
                <!-- Team Management Section -->
                <div class="add-employee-section">
                    <h3 style="margin-bottom: 20px; color: #2c3e50;">Team Management</h3>
                    
                    <!-- Add Individual Employee -->
                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #dee2e6;">
                        <h4 style="margin-bottom: 15px; color: #495057;">Add Individual Team Member</h4>
                        <div class="add-employee-form">
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" id="newEmployeeName" placeholder="Enter full name">
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <select id="newEmployeeRole">
                                    <option value="">Select Role</option>
                                    <option value="Junior Artist">Junior Artist</option>
                                    <option value="Artist">Artist</option>
                                    <option value="Senior Artist">Senior Artist</option>
                                    <option value="Lead Artist">Lead Artist</option>
                                    <option value="Supervisor">Supervisor</option>
                                    <option value="CG Supervisor">CG Supervisor</option>
                                    <option value="VFX Supervisor">VFX Supervisor</option>
                                    <option value="Asset Supervisor">Asset Supervisor</option>
                                    <option value="Anim Supervisor">Anim Supervisor</option>
                                    <option value="Comp Supervisor">Comp Supervisor</option>
                                    <option value="Frontend CG Supervisor">Frontend CG Supervisor</option>
                                </select>
                            </div>
                            <button class="add-btn" onclick="addNewEmployee()">Add Team Member</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Import/Export -->
                    <div>
                        <h4 style="margin-bottom: 15px; color: #495057;">Bulk Employee Management</h4>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                            <button class="export-btn" onclick="exportEmployees()">Export All Employees</button>
                            <button class="export-btn" style="background: linear-gradient(135deg, #28a745, #20c997);" onclick="exportEmployeeTemplate()">Download Template</button>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="file" id="employeeImportFile" accept=".csv,.json" style="display: none;" onchange="importEmployees(event)">
                                <button class="export-btn" style="background: linear-gradient(135deg, #6f42c1, #8b5cf6);" onclick="document.getElementById('employeeImportFile').click()">Import Employees</button>
                            </div>
                        </div>
                        <p style="margin-top: 10px; font-size: 0.85em; color: #6c757d;">
                            Supports CSV or JSON format. CSV columns: Name, Role, Password (optional)
                        </p>
                    </div>
                </div>
                
                <!-- Skills Management Section -->
                <div class="add-employee-section" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px; color: #2c3e50;">Skills Management</h3>
                    
                    <!-- Add New Skill -->
                    <div style="margin-bottom: 25px;">
                        <h4 style="margin-bottom: 15px; color: #495057;">Add New Skill</h4>
                        <div class="add-employee-form">
                            <div class="form-group">
                                <label>Category</label>
                                <select id="skillCategory">
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>New Skill Name</label>
                                <input type="text" id="newSkillName" placeholder="Enter skill name">
                            </div>
                            <button class="add-btn" onclick="addNewSkill()">Add Skill</button>
                        </div>
                    </div>
                    
                    <!-- Add New Category -->
                    <div style="padding-top: 25px; border-top: 1px solid #dee2e6;">
                        <h4 style="margin-bottom: 15px; color: #495057;">Add New Category</h4>
                        <div class="add-employee-form">
                            <div class="form-group">
                                <label>Category Name</label>
                                <input type="text" id="newCategoryName" placeholder="Enter category name (e.g., 'AI TOOLS')">
                            </div>
                            <div class="form-group">
                                <label>Category Type</label>
                                <select id="newCategoryType">
                                    <option value="department">Department Skills</option>
                                    <option value="software">Software/Tools</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <button class="add-btn" style="background: linear-gradient(135deg, #dc3545, #fd7e14);" onclick="addNewCategory()">Add Category</button>
                        </div>
                    </div>
                    
                    <!-- Export/Import Skills -->
                    <div style="margin-top: 25px; padding-top: 25px; border-top: 1px solid #dee2e6;">
                        <h4 style="margin-bottom: 15px; color: #495057;">Skills Import/Export</h4>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <button class="export-btn" onclick="exportSkills()">Export Skills Structure</button>
                            <input type="file" id="skillsImportFile" accept=".json" style="display: none;" onchange="importSkills(event)">
                            <button class="export-btn" style="background: linear-gradient(135deg, #6f42c1, #8b5cf6);" onclick="document.getElementById('skillsImportFile').click()">Import Skills</button>
                        </div>
                    </div>
                </div>

                <!-- Analytics Dashboard -->
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Team Completion</h3>
                        <div class="analytics-number" id="completionRate">0%</div>
                        <div class="analytics-label">Assessments Complete</div>
                    </div>
                    <div class="analytics-card">
                        <h3>Total Assessments</h3>
                        <div class="analytics-number" id="totalAssessments">0</div>
                        <div class="analytics-label">Individual Reviews</div>
                    </div>
                    <div class="analytics-card">
                        <h3>Expert Skills</h3>
                        <div class="analytics-number" id="expertCount">0</div>
                        <div class="analytics-label">Across All Areas</div>
                    </div>
                    <div class="analytics-card">
                        <h3>Skills Gaps</h3>
                        <div class="analytics-number" id="gapsCount">0</div>
                        <div class="analytics-label">Need Development</div>
                    </div>
                </div>
                
                <!-- Team Skill Coverage -->
                <div class="coverage-chart">
                    <h3 style="margin-bottom: 20px; color: #2c3e50;">Team Skill Coverage by Category</h3>
                    <div id="coverageVisualization"></div>
                </div>
                
                <div class="filters">
                    <div class="filter-group">
                        <label>Role Filter</label>
                        <select id="roleFilter" onchange="applyFilters()">
                            <option value="all">All Roles</option>
                            <option value="supervisor">Supervisors</option>
                            <option value="artist">Artists</option>
                            <option value="lead">Leads</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>Skill Category</label>
                        <select id="categoryFilter" onchange="applyFilters()">
                            <option value="all">All Categories</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>Skill Level</label>
                        <select id="skillLevelFilter" onchange="applyFilters()">
                            <option value="all">All Levels</option>
                            <option value="expert">Expert Only</option>
                            <option value="gaps">Show Gaps</option>
                            <option value="needs-review">Needs Review</option>
                        </select>
                    </div>

                    <button class="export-btn" onclick="exportOverview()">Export CSV</button>
                    <button class="export-btn" onclick="generateReport()">Generate Report</button>
                    <button class="export-btn" onclick="exportIndividualReports()">Individual Reports</button>
                </div>

                <div style="overflow-x: auto;">
                    <table class="overview-table" id="overviewTable">
                        <!-- Table will be populated by JavaScript -->
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Auto-save indicator -->
    <div id="autoSaveIndicator" class="auto-save-indicator">
        ✓ Auto-saved
    </div>

    <!-- Session info -->
    <div id="sessionInfo" class="session-info" style="display: none;">
        <span>Logged in as: <span id="sessionUser"></span></span>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <!-- Skill Definitions Modal -->
    <div class="skill-definitions-overlay" onclick="hideSkillDefinitions()"></div>
    <div class="skill-definitions-modal" id="skillDefinitionsModal">
        <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Skill Level Definitions</h2>
        
        <div class="skill-definition expert">
            <h4>Expert</h4>
            <p>Can train others, develop workflows, solve complex technical problems independently, and lead innovation in this area.</p>
        </div>
        
        <div class="skill-definition advanced">
            <h4>Advanced</h4>
            <p><span class="context-label">Department:</span>Can work independently, troubleshoot complex issues, mentor junior team members, and contribute to process improvements.</p>
            <p><span class="context-label">Software/Render:</span>Can use the software extensively unsupervised. Does not need help working out solutions to problems within the software.</p>
        </div>
        
        <div class="skill-definition intermediate">
            <h4>Intermediate</h4>
            <p><span class="context-label">Department:</span>Know ALL the tools available to the department and how to use them proficiently without assistance. Sometimes struggle with technical problems where unable to decipher errors from the program or farm.</p>
            <p><span class="context-label">Software/Render:</span>Can navigate proficiently around the software and can identify and solve simple problems when encountered.</p>
        </div>
        
        <div class="skill-definition beginner">
            <h4>Beginner</h4>
            <p><span class="context-label">Department:</span>Can build an asset/scene/shot, populate with upstream content, generate a reviewable and publish all with the basic tools, though only have a rough idea of what content is generated and where it lives in SG and Storage.</p>
            <p><span class="context-label">Software/Render:</span>Have opened it before and can perform simple tasks but have much to learn.</p>
        </div>
        
        <div class="skill-definition none">
            <h4>None</h4>
            <p>No experience in this Department or DCC (Digital Content Creation tool).</p>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="btn" onclick="hideSkillDefinitions()" style="background: #6c757d;">Close</button>
        </div>
    </div>

    <script>
        // Enhanced skills data structure with categories and dependencies
        let skillsData = {
            "TECHNICAL SKILLS": {
                skills: [
                    "Modeling & Sculpting",
                    "Texturing & Materials", 
                    "Rigging & Character Setup",
                    "Animation",
                    "VFX & Simulation",
                    "Lighting & Shading",
                    "Compositing"
                ],
                type: "department"
            },
            "SOFTWARE PROFICIENCY": {
                skills: [
                    "Maya",
                    "Houdini", 
                    "Nuke",
                    "Unreal Engine",
                    "Blender",
                    "Katana",
                    "Harmony"
                ],
                type: "software"
            },
            "RENDERING SYSTEMS": {
                skills: [
                    "Arnold",
                    "RenderMan",
                    "Cycles",
                    "Karma"
                ],
                type: "software"
            },
            "LEADERSHIP & MANAGEMENT": {
                skills: [
                    "Team Leadership",
                    "Project Management", 
                    "Mentoring & Training",
                    "Client Communication",
                    "Creative Direction",
                    "Budget Management"
                ],
                type: "department"
            },
            "TECHNICAL DEVELOPMENT": {
                skills: [
                    "Python Scripting",
                    "Pipeline Development",
                    "MEL Scripting",
                    "Technical Documentation"
                ],
                type: "department"
            }
        };

        // Skill dependencies
        const skillDependencies = {
            "Houdini": ["Python Scripting", "VFX & Simulation"],
            "Pipeline Development": ["Python Scripting", "Technical Documentation"],
            "Team Leadership": ["Client Communication", "Project Management"],
            "Creative Direction": ["Team Leadership", "Client Communication"],
            "Rigging & Character Setup": ["Maya", "Python Scripting"],
            "VFX & Simulation": ["Houdini", "Python Scripting"],
            "Lighting & Shading": ["Arnold", "Maya"],
            "Compositing": ["Nuke"],
            "Technical Documentation": ["Project Management"]
        };

        // Role requirements
        const roleRequirements = {
            "CG Supervisor": {
                "Team Leadership": "Expert",
                "Project Management": "Advanced",
                "Maya": "Advanced",
                "Houdini": "Intermediate",
                "Client Communication": "Advanced",
                "Mentoring & Training": "Advanced"
            },
            "VFX Supervisor": {
                "Team Leadership": "Expert",
                "Creative Direction": "Expert",
                "VFX & Simulation": "Expert",
                "Houdini": "Expert",
                "Client Communication": "Expert"
            },
            "Asset Supervisor": {
                "Modeling & Sculpting": "Expert",
                "Texturing & Materials": "Expert",
                "Team Leadership": "Advanced",
                "Project Management": "Advanced"
            },
            "Anim Supervisor": {
                "Animation": "Expert",
                "Rigging & Character Setup": "Advanced",
                "Team Leadership": "Expert",
                "Maya": "Expert",
                "Mentoring & Training": "Expert"
            },
            "Senior Artist": {
                "Maya": "Advanced",
                "Project Management": "Intermediate",
                "Mentoring & Training": "Intermediate"
            },
            "Lead Artist": {
                "Team Leadership": "Intermediate",
                "Project Management": "Intermediate",
                "Maya": "Advanced"
            }
        };

        // Skill level definitions
        const skillLevelDefinitions = {
            expert: {
                short: "Can train & lead innovation",
                full: "Can train others, develop workflows, solve complex technical problems independently, and lead innovation in this area."
            },
            advanced: {
                short: "Works independently & mentors",
                full: {
                    department: "Can work independently, troubleshoot complex issues, mentor junior team members, and contribute to process improvements.",
                    software: "Can use the software extensively unsupervised. Does not need help working out solutions to problems within the software."
                }
            },
            intermediate: {
                short: "Proficient with occasional help",
                full: {
                    department: "Know ALL the tools available to the department and how to use them proficiently without assistance. Sometimes struggle with technical problems where unable to decipher errors from the program or farm.",
                    software: "Can navigate proficiently around the software and can identify and solve simple problems when encountered."
                }
            },
            beginner: {
                short: "Basic tasks with guidance",
                full: {
                    department: "Can build an asset/scene/shot, populate with upstream content, generate a reviewable and publish all with the basic tools, though only have a rough idea of what content is generated and where it lives in SG and Storage.",
                    software: "Have opened it before and can perform simple tasks but have much to learn."
                }
            },
            none: {
                short: "No experience",
                full: "No experience in this Department or DCC"
            }
        };

        // Employee data
        const employees = [
            { name: "Chris Barischoff", role: "CG Supervisor" },
            { name: "Ila", role: "CG Supervisor" },
            { name: "Nick Chong", role: "CG Supervisor" },
            { name: "Ben Shepperd", role: "CG Supervisor" },
            { name: "Joseph Li", role: "CG Supervisor" },
            { name: "Natalia", role: "CG Supervisor" },
            { name: "Tamer", role: "Frontend CG Supervisor" },
            { name: "John Saleem", role: "Asset Supervisor" },
            { name: "Rob Lodermeier", role: "Anim Supervisor" }
        ];

        // Store assessment data
        let assessmentData = {};
        let assessmentHistory = {};
        let assessmentComments = {};
        let trainingRequests = {};
        let teamGoals = {};
        let currentEmployee = null;
        let supervisorAccess = false;
        let userSession = null;
        let autoSaveTimeout = null;

        // Supervisor access control
        const supervisorPasswords = {
            'supervisor123': true,
            'admin2024': true,
            'vfxlead': true
        };

        function generatePassword(firstName) {
            const randomNumbers = Math.floor(1000 + Math.random() * 9000);
            return firstName + randomNumbers;
        }

        // Ensure passwords are always set
        function ensurePasswordsExist() {
            employees.forEach(emp => {
                if (!emp.password || emp.password === 'undefined') {
                    const firstName = emp.name.split(' ')[0];
                    emp.password = generatePassword(firstName);
                    console.log(`Generated password for ${emp.name}: ${emp.password}`);
                }
            });
        }

        function saveEmployeesList() {
            try {
                localStorage.setItem('vfxEmployeesList', JSON.stringify(employees));
                console.log('Employees saved to localStorage');
            } catch (error) {
                console.error('Could not save employees list:', error);
                showNotification('Warning: Could not save employees list', 'error');
            }
        }

        function loadEmployeesList() {
            try {
                const saved = localStorage.getItem('vfxEmployeesList');
                if (saved) {
                    const loadedEmployees = JSON.parse(saved);
                    console.log('Loaded employees from localStorage:', loadedEmployees);
                    
                    employees.length = 0;
                    loadedEmployees.forEach(emp => {
                        if (!emp.password || emp.password === 'undefined') {
                            const firstName = emp.name.split(' ')[0];
                            emp.password = generatePassword(firstName);
                            console.log(`Generated password for ${emp.name}: ${emp.password}`);
                        }
                        employees.push(emp);
                    });
                    
                    saveEmployeesList();
                } else {
                    console.log('No saved employees, using defaults');
                    ensurePasswordsExist();
                    saveEmployeesList();
                }
            } catch (error) {
                console.log('Could not load employees list:', error);
                ensurePasswordsExist();
            }
        }

        function saveAssessmentData() {
            try {
                localStorage.setItem('vfxSkillsAssessmentData', JSON.stringify(assessmentData));
                localStorage.setItem('vfxAssessmentHistory', JSON.stringify(assessmentHistory));
                localStorage.setItem('vfxAssessmentComments', JSON.stringify(assessmentComments));
                localStorage.setItem('vfxTrainingRequests', JSON.stringify(trainingRequests));
                localStorage.setItem('vfxTeamGoals', JSON.stringify(teamGoals));
                console.log('Assessment data saved to localStorage');
                showNotification('✓ Assessment saved successfully');
            } catch (error) {
                console.error('Could not save assessment data:', error);
                showNotification('❌ Failed to save assessment data', 'error');
            }
        }

        function loadAssessmentData() {
            try {
                const saved = localStorage.getItem('vfxSkillsAssessmentData');
                const history = localStorage.getItem('vfxAssessmentHistory');
                const comments = localStorage.getItem('vfxAssessmentComments');
                const training = localStorage.getItem('vfxTrainingRequests');
                const goals = localStorage.getItem('vfxTeamGoals');
                
                if (saved) {
                    assessmentData = JSON.parse(saved);
                    console.log('Loaded assessment data from localStorage:', Object.keys(assessmentData));
                } else {
                    console.log('No saved assessment data found, adding test data');
                    addTestData();
                }
                
                if (history) assessmentHistory = JSON.parse(history);
                if (comments) assessmentComments = JSON.parse(comments);
                if (training) trainingRequests = JSON.parse(training);
                if (goals) teamGoals = JSON.parse(goals);
                
            } catch (error) {
                console.log('Could not load assessment data:', error);
                assessmentData = {};
                addTestData();
            }
            
            // Update UI if needed
            if (supervisorAccess) {
                updateAnalytics();
                updateCoverageVisualization();
            }
        }

        function addTestData() {
            console.log('Adding test assessment data...');
            
            // Chris Barischoff - Senior CG Supervisor with strong technical skills
            assessmentData["Chris Barischoff"] = {
                "Modeling & Sculpting": "Advanced",
                "Texturing & Materials": "Expert",
                "Rigging & Character Setup": "Intermediate",
                "Animation": "Intermediate",
                "VFX & Simulation": "Expert",
                "Lighting & Shading": "Expert",
                "Compositing": "Advanced",
                "Maya": "Expert",
                "Houdini": "Expert",
                "Nuke": "Advanced",
                "Unreal Engine": "Intermediate",
                "Blender": "Intermediate",
                "Arnold": "Expert",
                "RenderMan": "Advanced",
                "Team Leadership": "Expert",
                "Project Management": "Advanced",
                "Mentoring & Training": "Expert",
                "Client Communication": "Advanced",
                "Python Scripting": "Advanced",
                "Pipeline Development": "Intermediate"
            };

            // Add some test history
            assessmentHistory["Chris Barischoff"] = [
                {
                    date: new Date(Date.now() - 180 * 24 * 60 * 60 * 1000).toISOString(),
                    skills: {
                        "Python Scripting": "Intermediate",
                        "Team Leadership": "Advanced"
                    }
                }
            ];

            // Ila - Strong in compositing and lighting
            assessmentData["Ila"] = {
                "Modeling & Sculpting": "Intermediate",
                "Texturing & Materials": "Advanced",
                "Rigging & Character Setup": "Beginner",
                "Animation": "Advanced",
                "VFX & Simulation": "Advanced",
                "Lighting & Shading": "Expert",
                "Compositing": "Expert",
                "Maya": "Expert",
                "Houdini": "Intermediate",
                "Nuke": "Expert",
                "Unreal Engine": "Beginner",
                "Katana": "Expert",
                "Arnold": "Expert",
                "Cycles": "Advanced",
                "Team Leadership": "Advanced",
                "Mentoring & Training": "Advanced",
                "Client Communication": "Intermediate"
            };

            console.log('Test data added');
            
            // Save the test data
            saveAssessmentData();
        }

        function updateAnalytics() {
            const totalEmployees = employees.length;
            const completedAssessments = Object.keys(assessmentData).length;
            const completionRate = totalEmployees > 0 ? Math.round((completedAssessments / totalEmployees) * 100) : 0;
            
            // Count expert skills and gaps
            const allSkills = Object.values(skillsData).flatMap(cat => cat.skills);
            let expertCount = 0;
            let gapsCount = 0;
            
            allSkills.forEach(skill => {
                const ratings = employees.map(emp => 
                    assessmentData[emp.name] && assessmentData[emp.name][skill] || 'not-assessed'
                );
                
                const experts = ratings.filter(r => r === 'Expert').length;
                const assessed = ratings.filter(r => r !== 'not-assessed').length;
                
                expertCount += experts;
                if (experts === 0 && assessed > 0) {
                    gapsCount++;
                }
            });
            
            // Update analytics display
            const completionEl = document.getElementById('completionRate');
            const totalEl = document.getElementById('totalAssessments');
            const expertEl = document.getElementById('expertCount');
            const gapsEl = document.getElementById('gapsCount');
            
            if (completionEl) completionEl.textContent = completionRate + '%';
            if (totalEl) totalEl.textContent = completedAssessments;
            if (expertEl) expertEl.textContent = expertCount;
            if (gapsEl) gapsEl.textContent = gapsCount;
        }

        function updateCoverageVisualization() {
            const container = document.getElementById('coverageVisualization');
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.entries(skillsData).forEach(([category, categoryData]) => {
                const skills = categoryData.skills;
                const totalPossible = skills.length * employees.length;
                
                let expertCount = 0;
                let advancedCount = 0;
                let intermediateCount = 0;
                let beginnerCount = 0;
                let noneCount = 0;
                
                skills.forEach(skill => {
                    employees.forEach(emp => {
                        const rating = assessmentData[emp.name] && assessmentData[emp.name][skill];
                        switch(rating) {
                            case 'Expert': expertCount++; break;
                            case 'Advanced': advancedCount++; break;
                            case 'Intermediate': intermediateCount++; break;
                            case 'Beginner': beginnerCount++; break;
                            case 'None': noneCount++; break;
                        }
                    });
                });
                
                const assessed = expertCount + advancedCount + intermediateCount + beginnerCount + noneCount;
                const notAssessed = totalPossible - assessed;
                
                const categoryHtml = `
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: #2c3e50;">${category}</h4>
                        <div class="coverage-bar">
                            ${expertCount > 0 ? `<div class="coverage-segment expert" style="width: ${(expertCount/totalPossible)*100}%">${expertCount}</div>` : ''}
                            ${advancedCount > 0 ? `<div class="coverage-segment advanced" style="width: ${(advancedCount/totalPossible)*100}%">${advancedCount}</div>` : ''}
                            ${intermediateCount > 0 ? `<div class="coverage-segment intermediate" style="width: ${(intermediateCount/totalPossible)*100}%">${intermediateCount}</div>` : ''}
                            ${beginnerCount > 0 ? `<div class="coverage-segment beginner" style="width: ${(beginnerCount/totalPossible)*100}%">${beginnerCount}</div>` : ''}
                            ${noneCount > 0 ? `<div class="coverage-segment none" style="width: ${(noneCount/totalPossible)*100}%">${noneCount}</div>` : ''}
                            ${notAssessed > 0 ? `<div class="coverage-segment not-assessed" style="width: ${(notAssessed/totalPossible)*100}%"></div>` : ''}
                        </div>
                        <div style="font-size: 0.85em; color: #6c757d; margin-top: 5px;">
                            Coverage: ${Math.round((assessed/totalPossible)*100)}% | 
                            Expert/Advanced: ${expertCount + advancedCount} | 
                            Skills needing development: ${beginnerCount + noneCount}
                        </div>
                    </div>
                `;
                
                container.innerHTML += categoryHtml;
            });
        }

        function addNewEmployee() {
            console.log('Adding new employee...');
            const nameInput = document.getElementById('newEmployeeName');
            const roleInput = document.getElementById('newEmployeeRole');
            
            if (!nameInput || !roleInput) {
                console.error('Form inputs not found');
                showNotification('Form error - please refresh the page', 'error');
                return;
            }
            
            const name = nameInput.value.trim();
            const role = roleInput.value;
            
            console.log('Name:', name, 'Role:', role);
            
            if (!name || !role) {
                showNotification('Please enter both name and role', 'error');
                return;
            }
            
            // Validate name doesn't already exist
            if (employees.find(emp => emp.name.toLowerCase() === name.toLowerCase())) {
                showNotification('Employee already exists', 'error');
                return;
            }
            
            // Generate password (first name + 4 random numbers)
            const firstName = name.split(' ')[0];
            const password = generatePassword(firstName);
            
            console.log('Generated password:', password);
            
            // Add new employee
            const newEmployee = { name, role, password };
            employees.push(newEmployee);
            
            console.log('Updated employees array:', employees);
            
            // Save employees list
            saveEmployeesList();
            
            // Clear form
            nameInput.value = '';
            roleInput.value = '';
            
            // Refresh displays
            populateEmployeeGrid();
            if (supervisorAccess) {
                populateOverview();
                updateAnalytics();
                updateCoverageVisualization();
            }
            
            showNotification(`${name} added successfully! Password: ${password}`);
        }

        function requestSupervisorAccess() {
            if (supervisorAccess) {
                showView('overview');
                return;
            }
            
            const password = prompt('Enter supervisor password to access overview:');
            
            if (supervisorPasswords[password]) {
                supervisorAccess = true;
                sessionStorage.setItem('supervisorSession', 'true');
                document.querySelectorAll('.supervisor-only').forEach(el => {
                    el.classList.add('visible');
                });
                showView('overview');
                showNotification('Supervisor access granted!');
                updateSessionInfo('Supervisor');
            } else if (password !== null) {
                showNotification('Invalid supervisor password', 'error');
            }
        }

        function requestUserLogin(employeeName) {
            return new Promise((resolve, reject) => {
                const employee = employees.find(emp => emp.name === employeeName);
                if (!employee) {
                    reject('Employee not found');
                    return;
                }

                console.log('Employee login request for:', employee);

                // Create password modal
                const overlay = document.createElement('div');
                overlay.className = 'password-overlay';
                
                overlay.innerHTML = `
                    <div class="password-modal">
                        <h3>Welcome ${employee.name}</h3>
                        <div class="password-hint">
                            <strong>Your password is:</strong> ${employee.password || 'Password not set'}
                        </div>
                        <input type="password" id="userPassword" placeholder="Enter your password" maxlength="20">
                        <div>
                            <button class="btn" onclick="verifyUserPassword('${employeeName}')">Login</button>
                            <button class="btn" onclick="closePasswordModal()" style="background: #6c757d;">Cancel</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                document.getElementById('userPassword').focus();
                
                // Store resolve function for later use
                window.currentLoginResolve = resolve;
                window.currentLoginReject = reject;
            });
        }

        function verifyUserPassword(employeeName) {
            const enteredPassword = document.getElementById('userPassword').value;
            const employee = employees.find(emp => emp.name === employeeName);
            
            if (employee && employee.password === enteredPassword) {
                userSession = employeeName;
                sessionStorage.setItem('userSession', employeeName);
                closePasswordModal();
                updateSessionInfo(employeeName);
                window.currentLoginResolve(true);
                showNotification(`Welcome ${employeeName}!`);
            } else {
                showNotification('Incorrect password', 'error');
                document.getElementById('userPassword').value = '';
                document.getElementById('userPassword').focus();
            }
        }

        function closePasswordModal() {
            const overlay = document.querySelector('.password-overlay');
            if (overlay) {
                overlay.remove();
            }
            if (window.currentLoginReject) {
                window.currentLoginReject('Login cancelled');
            }
        }

        function logout() {
            // Clear all sessions
            supervisorAccess = false;
            userSession = null;
            
            // Clear session storage
            sessionStorage.removeItem('supervisorSession');
            sessionStorage.removeItem('userSession');
            
            // Hide supervisor buttons
            document.querySelectorAll('.supervisor-only').forEach(el => {
                el.classList.remove('visible');
            });
            
            // Hide session info
            document.getElementById('sessionInfo').style.display = 'none';
            
            // Go back to home
            showView('home');
            
            // Show notification
            showNotification('Logged out successfully');
            
            console.log('User logged out');
        }

        function updateSessionInfo(user) {
            const sessionInfo = document.getElementById('sessionInfo');
            const sessionUser = document.getElementById('sessionUser');
            sessionUser.textContent = user;
            sessionInfo.style.display = 'flex';
        }

        function checkExistingSessions() {
            // Check for existing supervisor session
            if (sessionStorage.getItem('supervisorSession')) {
                supervisorAccess = true;
                document.querySelectorAll('.supervisor-only').forEach(el => {
                    el.classList.add('visible');
                });
                updateSessionInfo('Supervisor');
            }
            
            // Check for existing user session
            const savedUserSession = sessionStorage.getItem('userSession');
            if (savedUserSession) {
                userSession = savedUserSession;
                updateSessionInfo(savedUserSession);
            }
        }

        // Initialize the application
        async function initializeApp() {
            console.log('Initializing app...');
            console.log('Default employees:', employees);
            
            // Load skills first
            loadSkillsData();
            
            // Ensure passwords exist before loading
            ensurePasswordsExist();
            
            await loadEmployeesList();
            console.log('After loading employees:', employees);
            
            await loadAssessmentData();
            checkExistingSessions();
            
            // Small delay to ensure DOM is ready
            setTimeout(() => {
                populateEmployeeGrid();
                updateSkillCategoryDropdown();
            }, 100);
        }

        function populateEmployeeGrid() {
            console.log('Populating employee grid with:', employees);
            const grid = document.getElementById('employeeGrid');
            
            if (!employees || employees.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;"><h3>No team members found</h3><p>Supervisors can add new team members from the overview page.</p></div>';
                return;
            }
            
            grid.innerHTML = '';

            employees.forEach((employee, index) => {
                console.log(`Creating card for employee ${index}:`, employee);
                const completion = getCompletionStatus(employee.name);
                const card = document.createElement('div');
                card.className = 'employee-card';
                card.onclick = () => handleEmployeeSelection(employee.name, employee.role);
                
                // Check if needs review
                const needsReview = trainingRequests[employee.name] && 
                    Object.values(trainingRequests[employee.name]).some(v => v === true);
                
                card.innerHTML = `
                    <div class="employee-name">${employee.name}</div>
                    <div class="employee-role">${employee.role}</div>
                    <div class="completion-status ${completion.class}">${completion.text}</div>
                    ${needsReview ? '<span class="needs-review">Needs Review</span>' : ''}
                `;
                
                grid.appendChild(card);
            });
            
            console.log(`Employee grid populated with ${employees.length} employees`);
        }

        async function handleEmployeeSelection(employeeName, employeeRole) {
            // Don't allow employee login if supervisor is logged in
            if (supervisorAccess) {
                showNotification('Please logout of supervisor mode first to access employee assessments', 'error');
                return;
            }
            
            try {
                // Check if user is already logged in as this employee
                if (userSession === employeeName) {
                    startAssessment(employeeName, employeeRole);
                    return;
                }
                
                // Request login
                await requestUserLogin(employeeName);
                startAssessment(employeeName, employeeRole);
            } catch (error) {
                console.log('Login cancelled or failed:', error);
            }
        }

        function getCompletionStatus(employeeName) {
            const data = assessmentData[employeeName];
            if (!data) return { class: 'not-started', text: 'Not Started' };
            
            const totalSkills = Object.values(skillsData).flatMap(cat => cat.skills).length;
            const completedSkills = Object.keys(data).length;
            const percentage = (completedSkills / totalSkills) * 100;
            
            if (percentage === 100) return { class: 'completed', text: 'Completed' };
            if (percentage > 0) return { class: 'pending', text: `${Math.round(percentage)}% Complete` };
            return { class: 'not-started', text: 'Not Started' };
        }

        function startAssessment(employeeName, employeeRole) {
            currentEmployee = employeeName;
            document.getElementById('employeeNameRole').textContent = `${employeeName} - ${employeeRole}`;
            
            // Show role requirements if applicable
            if (roleRequirements[employeeRole]) {
                showRoleRequirements(employeeRole);
            }
            
            populateAssessmentForm();
            updateProgress();
            showView('assessment');
        }

        function showRoleRequirements(role) {
            const reqContainer = document.getElementById('roleRequirements');
            const reqList = document.getElementById('requirementsList');
            const requirements = roleRequirements[role];
            
            if (!requirements) {
                reqContainer.style.display = 'none';
                return;
            }
            
            reqContainer.style.display = 'block';
            reqList.innerHTML = '';
            
            Object.entries(requirements).forEach(([skill, level]) => {
                const currentLevel = assessmentData[currentEmployee] && assessmentData[currentEmployee][skill];
                const meetsReq = isLevelSufficient(currentLevel, level);
                
                reqList.innerHTML += `
                    <div class="requirement-item">
                        <span>${skill}: ${level}</span>
                        <span class="${meetsReq ? 'requirement-met' : 'requirement-not-met'}">
                            ${meetsReq ? '✓' : '✗'} ${currentLevel || 'Not Assessed'}
                        </span>
                    </div>
                `;
            });
        }

        function isLevelSufficient(current, required) {
            const levels = ['None', 'Beginner', 'Intermediate', 'Advanced', 'Expert'];
            const currentIndex = levels.indexOf(current);
            const requiredIndex = levels.indexOf(required);
            return currentIndex >= requiredIndex;
        }

        function populateAssessmentForm() {
            const container = document.getElementById('skillsSections');
            container.innerHTML = '';

            Object.entries(skillsData).forEach(([category, categoryData]) => {
                const skills = categoryData.skills;
                const categoryType = categoryData.type;
                
                const section = document.createElement('div');
                section.className = 'skills-section';
                
                const categoryClass = category.toLowerCase().replace(/[^a-z]/g, '');
                section.innerHTML = `
                    <div class="section-title">
                        ${category}
                        <span class="section-type">${categoryType === 'department' ? 'Department Skills' : 'Software/Tools'}</span>
                    </div>
                    <div class="skills-grid">
                        ${skills.map(skill => {
                            const dependencies = skillDependencies[skill];
                            const depText = dependencies ? `Recommended: ${dependencies.join(', ')}` : '';
                            
                            return `
                                <div class="skill-row">
                                    <div class="skill-name">
                                        ${skill}
                                        ${depText ? `<span class="skill-dependencies">(${depText})</span>` : ''}
                                    </div>
                                    <div class="rating-buttons">
                                        <button class="rating-btn none" onclick="selectRating('${skill}', 'None')">
                                            <div class="inline-help">${skillLevelDefinitions.none.short}</div>
                                            None
                                        </button>
                                        <button class="rating-btn beginner" onclick="selectRating('${skill}', 'Beginner')">
                                            <div class="inline-help">${skillLevelDefinitions.beginner.short}</div>
                                            Beginner
                                        </button>
                                        <button class="rating-btn intermediate" onclick="selectRating('${skill}', 'Intermediate')">
                                            <div class="inline-help">${skillLevelDefinitions.intermediate.short}</div>
                                            Intermediate
                                        </button>
                                        <button class="rating-btn advanced" onclick="selectRating('${skill}', 'Advanced')">
                                            <div class="inline-help">${skillLevelDefinitions.advanced.short}</div>
                                            Advanced
                                        </button>
                                        <button class="rating-btn expert" onclick="selectRating('${skill}', 'Expert')">
                                            <div class="inline-help">${skillLevelDefinitions.expert.short}</div>
                                            Expert
                                        </button>
                                    </div>
                                </div>
                                <div class="comment-section" id="comment-${skill.replace(/[^a-zA-Z0-9]/g, '')}">
                                    <textarea class="comment-input" placeholder="Add comments about this skill (optional)" 
                                        onchange="saveComment('${skill}', this.value)">${assessmentComments[currentEmployee] && assessmentComments[currentEmployee][skill] || ''}</textarea>
                                    <label class="training-checkbox">
                                        <input type="checkbox" onchange="toggleTrainingRequest('${skill}', this.checked)"
                                            ${trainingRequests[currentEmployee] && trainingRequests[currentEmployee][skill] ? 'checked' : ''}>
                                        I would like training for this skill
                                    </label>
                                </div>
                                <span class="comment-toggle" onclick="toggleComment('${skill.replace(/[^a-zA-Z0-9]/g, '')}')">
                                    ${assessmentComments[currentEmployee] && assessmentComments[currentEmployee][skill] ? 'Hide' : 'Add'} notes
                                </span>
                            `;
                        }).join('')}
                    </div>
                `;
                
                container.appendChild(section);
            });

            // Load existing ratings
            loadCurrentRatings();
        }

        function toggleComment(skillId) {
            const commentSection = document.getElementById(`comment-${skillId}`);
            const toggle = event.target;
            
            if (commentSection.classList.contains('active')) {
                commentSection.classList.remove('active');
                toggle.textContent = 'Add notes';
            } else {
                commentSection.classList.add('active');
                toggle.textContent = 'Hide notes';
            }
        }

        function saveComment(skill, comment) {
            if (!assessmentComments[currentEmployee]) {
                assessmentComments[currentEmployee] = {};
            }
            assessmentComments[currentEmployee][skill] = comment;
            autoSaveAssessment();
        }

        function toggleTrainingRequest(skill, requested) {
            if (!trainingRequests[currentEmployee]) {
                trainingRequests[currentEmployee] = {};
            }
            trainingRequests[currentEmployee][skill] = requested;
            autoSaveAssessment();
        }

        function loadCurrentRatings() {
            if (!currentEmployee || !assessmentData[currentEmployee]) return;
            
            const data = assessmentData[currentEmployee];
            Object.entries(data).forEach(([skill, rating]) => {
                const buttons = document.querySelectorAll(`button[onclick*="selectRating('${skill}'"]`);
                buttons.forEach(btn => {
                    btn.classList.remove('selected');
                    if (btn.textContent.trim() === rating) {
                        btn.classList.add('selected');
                    }
                });
                
                // Show comment section if there's a comment
                if (assessmentComments[currentEmployee] && assessmentComments[currentEmployee][skill]) {
                    const skillId = skill.replace(/[^a-zA-Z0-9]/g, '');
                    const commentSection = document.getElementById(`comment-${skillId}`);
                    if (commentSection) {
                        commentSection.classList.add('active');
                        const toggle = commentSection.nextElementSibling;
                        if (toggle) toggle.textContent = 'Hide notes';
                    }
                }
            });
            
            // Update role requirements display
            const employee = employees.find(emp => emp.name === currentEmployee);
            if (employee && roleRequirements[employee.role]) {
                showRoleRequirements(employee.role);
            }
        }

        function selectRating(skill, rating) {
            // Initialize employee data if it doesn't exist
            if (!assessmentData[currentEmployee]) {
                assessmentData[currentEmployee] = {};
            }
            
            // Store previous rating for history
            const previousRating = assessmentData[currentEmployee][skill];
            
            // Save the rating
            assessmentData[currentEmployee][skill] = rating;
            
            // Update history if rating changed
            if (previousRating && previousRating !== rating) {
                if (!assessmentHistory[currentEmployee]) {
                    assessmentHistory[currentEmployee] = [];
                }
                assessmentHistory[currentEmployee].push({
                    date: new Date().toISOString(),
                    skill,
                    from: previousRating,
                    to: rating
                });
            }
            
            // Update button states
            const buttons = document.querySelectorAll(`button[onclick*="selectRating('${skill}'"]`);
            buttons.forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent.trim() === rating) {
                    btn.classList.add('selected');
                }
            });
            
            // Update progress
            updateProgress();
            
            // Update role requirements if applicable
            const employee = employees.find(emp => emp.name === currentEmployee);
            if (employee && roleRequirements[employee.role]) {
                showRoleRequirements(employee.role);
            }
            
            // Auto-save with debouncing
            autoSaveAssessment();
        }

        function autoSaveAssessment() {
            // Clear existing timeout
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
            }
            
            // Set new timeout for auto-save
            autoSaveTimeout = setTimeout(() => {
                saveAssessmentData();
                showAutoSaveIndicator();
            }, 1000); // Auto-save after 1 second of inactivity
        }

        function showAutoSaveIndicator() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        function updateProgress() {
            if (!currentEmployee) return;
            
            const totalSkills = Object.values(skillsData).flatMap(cat => cat.skills).length;
            const completedSkills = assessmentData[currentEmployee] ? Object.keys(assessmentData[currentEmployee]).length : 0;
            const percentage = (completedSkills / totalSkills) * 100;
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = Math.round(percentage) + '% Complete';
        }

        function saveAssessment() {
            if (!currentEmployee) return;
            
            saveAssessmentData();
            showNotification('Assessment saved successfully!');
            showView('home');
            populateEmployeeGrid(); // Refresh completion status
        }

        function showView(viewName) {
            // Check supervisor access for overview
            if (viewName === 'overview' && !supervisorAccess) {
                requestSupervisorAccess();
                return;
            }
            
            // Check if user is logged in for certain views
            if ((viewName === 'progress' || viewName === 'learningPaths') && !userSession) {
                showNotification('Please log in to access this feature', 'error');
                return;
            }
            
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            // Show selected view
            document.getElementById(viewName).classList.add('active');
            
            // Update nav buttons
            document.querySelectorAll('.btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Find and activate the correct button
            const targetBtn = Array.from(document.querySelectorAll('.btn')).find(btn => {
                const btnText = btn.textContent.toLowerCase();
                return btnText.includes(viewName === 'home' ? 'home' : 
                       viewName === 'assessment' ? 'assessment' : 
                       viewName === 'overview' ? 'overview' :
                       viewName === 'progress' ? 'progress' :
                       viewName === 'learningPaths' ? 'learning' : '');
            });
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
            
            // Populate view-specific content
            if (viewName === 'overview') {
                populateOverview();
                updateAnalytics();
                updateCategoryFilterDropdown();
                updateCoverageVisualization();
            } else if (viewName === 'progress' && userSession) {
                showProgressHistory();
            } else if (viewName === 'learningPaths' && userSession) {
                showLearningPaths();
            }
        }

        function showProgressHistory() {
            const container = document.getElementById('progressContent');
            const history = assessmentHistory[userSession] || [];
            const currentData = assessmentData[userSession] || {};
            
            let html = '<div class="progress-history">';
            
            // Current skill summary
            html += '<h3 style="margin-bottom: 20px;">Current Skill Levels</h3>';
            html += '<div class="analytics-grid" style="margin-bottom: 30px;">';
            
            const levels = ['Expert', 'Advanced', 'Intermediate', 'Beginner', 'None'];
            levels.forEach(level => {
                const count = Object.values(currentData).filter(v => v === level).length;
                html += `
                    <div class="analytics-card">
                        <h3>${level}</h3>
                        <div class="analytics-number ${level.toLowerCase()}" style="color: inherit;">${count}</div>
                        <div class="analytics-label">Skills</div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // Progress history
            html += '<h3 style="margin-bottom: 20px;">Recent Progress</h3>';
            
            if (history.length > 0) {
                const recentHistory = history.slice(-10).reverse();
                recentHistory.forEach(item => {
                    const date = new Date(item.date).toLocaleDateString();
                    const improved = isImprovement(item.from, item.to);
                    
                    html += `
                        <div class="history-item">
                            <div>
                                <div class="history-date">${date}</div>
                                <div style="color: #6c757d;">${item.skill}</div>
                            </div>
                            <div class="history-change ${improved ? 'change-positive' : 'change-negative'}">
                                ${item.from} → ${item.to}
                                ${improved ? '↑' : '↓'}
                            </div>
                        </div>
                    `;
                });
            } else {
                html += '<p style="color: #6c757d;">No progress history yet. Complete assessments to track your growth!</p>';
            }
            
            html += '</div>';
            
            // Export personal report button
            html += '<div style="text-align: center; margin-top: 30px;">';
            html += '<button class="export-btn" onclick="exportPersonalReport()">Export My Progress Report</button>';
            html += '</div>';
            
            container.innerHTML = html;
        }

        function isImprovement(from, to) {
            const levels = ['None', 'Beginner', 'Intermediate', 'Advanced', 'Expert'];
            return levels.indexOf(to) > levels.indexOf(from);
        }

        function showLearningPaths() {
            const container = document.getElementById('learningPathsContent');
            const currentData = assessmentData[userSession] || {};
            const employee = employees.find(emp => emp.name === userSession);
            const role = employee ? employee.role : '';
            
            let html = '<div>';
            
            // Role-based recommendations
            if (roleRequirements[role]) {
                html += '<div class="learning-path">';
                html += `<h3 style="margin-bottom: 15px;">Skills Required for ${role}</h3>`;
                
                Object.entries(roleRequirements[role]).forEach(([skill, required]) => {
                    const current = currentData[skill];
                    const sufficient = isLevelSufficient(current, required);
                    
                    if (!sufficient) {
                        html += `
                            <div class="path-item">
                                <span class="path-arrow">→</span>
                                <strong>${skill}</strong>: Current (${current || 'Not Assessed'}) → Required (${required})
                            </div>
                        `;
                    }
                });
                
                html += '</div>';
            }
            
            // Dependency-based recommendations
            html += '<div class="learning-path" style="margin-top: 20px;">';
            html += '<h3 style="margin-bottom: 15px;">Recommended Learning Sequence</h3>';
            
            const recommendations = [];
            Object.entries(skillDependencies).forEach(([skill, deps]) => {
                const skillLevel = currentData[skill];
                const depsReady = deps.every(dep => {
                    const depLevel = currentData[dep];
                    return depLevel && depLevel !== 'None' && depLevel !== 'Beginner';
                });
                
                if ((!skillLevel || skillLevel === 'None' || skillLevel === 'Beginner') && depsReady) {
                    recommendations.push({
                        skill,
                        reason: `You have the prerequisites: ${deps.join(', ')}`
                    });
                }
            });
            
            if (recommendations.length > 0) {
                recommendations.forEach(rec => {
                    html += `
                        <div class="path-item">
                            <span class="path-arrow">→</span>
                            <strong>${rec.skill}</strong>
                            <span style="color: #6c757d; font-size: 0.9em;">(${rec.reason})</span>
                        </div>
                    `;
                });
            } else {
                html += '<p style="color: #6c757d;">Keep building your foundational skills!</p>';
            }
            
            html += '</div>';
            
            // Skills marked for training
            const trainingSkills = trainingRequests[userSession] || {};
            const requestedSkills = Object.entries(trainingSkills).filter(([_, requested]) => requested);
            
            if (requestedSkills.length > 0) {
                html += '<div class="learning-path" style="margin-top: 20px;">';
                html += '<h3 style="margin-bottom: 15px;">Your Training Requests</h3>';
                
                requestedSkills.forEach(([skill, _]) => {
                    html += `
                        <div class="path-item">
                            <span class="path-arrow">→</span>
                            ${skill}
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function exportPersonalReport() {
            const employee = employees.find(emp => emp.name === userSession);
            if (!employee) return;
            
            const currentData = assessmentData[userSession] || {};
            const history = assessmentHistory[userSession] || [];
            const comments = assessmentComments[userSession] || {};
            const training = trainingRequests[userSession] || {};
            
            let reportHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Skills Assessment Report - ${userSession}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; max-width: 800px; margin: 0 auto; }
                        .header { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
                        h1 { color: #2c3e50; }
                        .section { margin-bottom: 30px; }
                        .skill-item { padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; }
                        .expert { background: #2E86AB; color: white; }
                        .advanced { background: #A23B72; color: white; }
                        .intermediate { background: #CA653A; color: white; }
                        .beginner { background: #F18F01; color: white; }
                        .none { background: #6c757d; color: white; }
                        @media print { .no-print { display: none; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Skills Assessment Report</h1>
                        <p><strong>Name:</strong> ${userSession}</p>
                        <p><strong>Role:</strong> ${employee.role}</p>
                        <p><strong>Generated:</strong> ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <div class="section">
                        <h2>Current Skills Assessment</h2>
            `;
            
            Object.entries(skillsData).forEach(([category, categoryData]) => {
                reportHTML += `<h3>${category}</h3>`;
                categoryData.skills.forEach(skill => {
                    const level = currentData[skill] || 'Not Assessed';
                    const comment = comments[skill] || '';
                    const wantsTraining = training[skill] || false;
                    
                    reportHTML += `
                        <div class="skill-item">
                            <strong>${skill}:</strong> 
                            <span class="${level.toLowerCase().replace(' ', '-')}" style="padding: 2px 8px; border-radius: 4px;">
                                ${level}
                            </span>
                            ${comment ? `<p style="margin: 5px 0; font-style: italic;">Notes: ${comment}</p>` : ''}
                            ${wantsTraining ? '<p style="margin: 5px 0; color: #007bff;">✓ Training Requested</p>' : ''}
                        </div>
                    `;
                });
            });
            
            // Add progress history
            if (history.length > 0) {
                reportHTML += `
                    </div>
                    <div class="section">
                        <h2>Progress History</h2>
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 8px; text-align: left;">Date</th>
                                    <th style="padding: 8px; text-align: left;">Skill</th>
                                    <th style="padding: 8px; text-align: left;">Progress</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                history.slice(-20).reverse().forEach(item => {
                    const improved = isImprovement(item.from, item.to);
                    reportHTML += `
                        <tr>
                            <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">
                                ${new Date(item.date).toLocaleDateString()}
                            </td>
                            <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">${item.skill}</td>
                            <td style="padding: 8px; border-bottom: 1px solid #dee2e6; color: ${improved ? '#28a745' : '#dc3545'};">
                                ${item.from} → ${item.to} ${improved ? '↑' : '↓'}
                            </td>
                        </tr>
                    `;
                });
                
                reportHTML += '</tbody></table>';
            }
            
            reportHTML += `
                    </div>
                </body>
                </html>
            `;
            
            // Download report
            const blob = new Blob([reportHTML], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `skills_report_${userSession.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showNotification('Personal report exported successfully!');
        }

        function populateOverview() {
            const table = document.getElementById('overviewTable');
            const allSkills = Object.values(skillsData).flatMap(cat => cat.skills);
            
            // Create header
            let headerHTML = '<thead><tr><th>Skills & Competencies</th>';
            employees.forEach(emp => {
                headerHTML += `<th style="writing-mode: vertical-rl; text-orientation: mixed; min-width: 100px;">${emp.name}<br><small>${emp.role}</small></th>`;
            });
            headerHTML += '</tr></thead>';
            
            // Create body with sections
            let bodyHTML = '<tbody>';
            Object.entries(skillsData).forEach(([category, categoryData]) => {
                const skills = categoryData.skills;
                // Section header
                bodyHTML += `<tr><td colspan="${employees.length + 1}" style="background: #6c757d; color: white; font-weight: bold; padding: 15px 20px;">${category}</td></tr>`;
                
                // Skills rows
                skills.forEach(skill => {
                    bodyHTML += `<tr class="skill-row-overview" data-skill="${skill}" data-category="${category}"><td>${skill}</td>`;
                    employees.forEach(emp => {
                        const rating = assessmentData[emp.name] && assessmentData[emp.name][skill] || 'not-assessed';
                        const hasComment = assessmentComments[emp.name] && assessmentComments[emp.name][skill];
                        const wantsTraining = trainingRequests[emp.name] && trainingRequests[emp.name][skill];
                        const ratingClass = rating.toLowerCase().replace(' ', '-');
                        
                        bodyHTML += `<td>
                            <span class="skill-rating ${ratingClass}">${rating === 'not-assessed' ? 'N/A' : rating}</span>
                            ${hasComment ? ' 💬' : ''}
                            ${wantsTraining ? ' 📚' : ''}
                        </td>`;
                    });
                    bodyHTML += '</tr>';
                });
            });
            bodyHTML += '</tbody>';
            
            table.innerHTML = headerHTML + bodyHTML;
        }

        function updateCategoryFilterDropdown() {
            const dropdown = document.getElementById('categoryFilter');
            if (!dropdown) return;
            
            // Store current value
            const currentValue = dropdown.value;
            
            // Clear and rebuild options
            dropdown.innerHTML = '<option value="all">All Categories</option>';
            
            // Add dynamic categories
            Object.keys(skillsData).forEach(category => {
                const option = document.createElement('option');
                const simplifiedValue = category.toLowerCase().replace(/[^a-z]/g, '');
                option.value = simplifiedValue;
                option.textContent = category;
                dropdown.appendChild(option);
            });
            
            // Restore previous selection if still valid
            if (currentValue && Array.from(dropdown.options).some(opt => opt.value === currentValue)) {
                dropdown.value = currentValue;
            }
        }

        function applyFilters() {
            const roleFilter = document.getElementById('roleFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const skillLevelFilter = document.getElementById('skillLevelFilter').value;
            
            const rows = document.querySelectorAll('.skill-row-overview');
            const headers = document.querySelectorAll('#overviewTable th');
            
            // Show/hide columns based on role filter
            headers.forEach((header, index) => {
                if (index === 0) return; // Skip first column (skills)
                
                const employeeIndex = index - 1;
                const employee = employees[employeeIndex];
                let showColumn = true;
                
                if (roleFilter !== 'all') {
                    const role = employee.role.toLowerCase();
                    showColumn = role.includes(roleFilter.toLowerCase());
                }
                
                header.style.display = showColumn ? '' : 'none';
                
                // Hide corresponding cells in all rows
                document.querySelectorAll(`#overviewTable td:nth-child(${index + 1})`).forEach(cell => {
                    cell.style.display = showColumn ? '' : 'none';
                });
            });
            
            // Show/hide rows based on category and skill level filters
            rows.forEach(row => {
                let showRow = true;
                
                if (categoryFilter !== 'all') {
                    const category = row.dataset.category;
                    const simplifiedFilter = categoryFilter.toLowerCase();
                    const simplifiedCategory = category.toLowerCase().replace(/[^a-z]/g, '');
                    showRow = simplifiedCategory.includes(simplifiedFilter) || category.toLowerCase().includes(simplifiedFilter);
                }
                
                if (skillLevelFilter !== 'all' && showRow) {
                    const ratings = Array.from(row.querySelectorAll('.skill-rating')).map(span => span.textContent.toLowerCase());
                    
                    if (skillLevelFilter === 'expert') {
                        showRow = ratings.includes('expert');
                    } else if (skillLevelFilter === 'gaps') {
                        showRow = ratings.includes('n/a') || ratings.filter(r => r === 'beginner' || r === 'none').length > ratings.length / 2;
                    } else if (skillLevelFilter === 'needs-review') {
                        // Check if any employee has training request for this skill
                        const skill = row.dataset.skill;
                        showRow = employees.some(emp => 
                            trainingRequests[emp.name] && trainingRequests[emp.name][skill]
                        );
                    }
                }
                
                row.style.display = showRow ? '' : 'none';
            });
            
            showNotification('Filters applied successfully!');
        }

        function exportOverview() {
            const table = document.getElementById('overviewTable');
            let csv = [];
            
            // Get visible headers
            const headers = [];
            table.querySelectorAll('thead th').forEach(th => {
                if (th.style.display !== 'none') {
                    headers.push('"' + th.textContent.replace(/"/g, '""').replace(/\n/g, ' ') + '"');
                }
            });
            csv.push(headers.join(','));
            
            // Get visible data rows
            table.querySelectorAll('tbody tr').forEach(tr => {
                if (tr.style.display !== 'none') {
                    const row = [];
                    tr.querySelectorAll('td').forEach((td, index) => {
                        if (td.style.display !== 'none') {
                            let cellText = td.textContent.trim();
                            if (td.querySelector('.skill-rating')) {
                                cellText = td.querySelector('.skill-rating').textContent.trim();
                            }
                            row.push('"' + cellText.replace(/"/g, '""') + '"');
                        }
                    });
                    if (row.length > 0) {
                        csv.push(row.join(','));
                    }
                }
            });
            
            // Download CSV
            const csvContent = csv.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'skills_overview_' + new Date().toISOString().split('T')[0] + '.csv';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showNotification('Overview exported successfully!');
        }

        function generateReport() {
            const matrix = analyzeOverviewData();
            
            const reportHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Skills Assessment Analysis Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; max-width: 1200px; margin: 0 auto; }
                        .header { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6; }
                        .section { margin-bottom: 30px; }
                        .skill-gap { background: #fff3cd; padding: 10px; margin: 5px 0; border-radius: 4px; border-left: 4px solid #ffc107; }
                        .strength { background: #d4edda; padding: 10px; margin: 5px 0; border-radius: 4px; border-left: 4px solid #28a745; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background: #f8f9fa; font-weight: 600; }
                        .risk-high { background: #f8d7da !important; }
                        .risk-medium { background: #fff3cd !important; }
                        .risk-low { background: #d4edda !important; }
                        h1 { color: #2c3e50; margin-bottom: 10px; }
                        h2 { color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
                        h3 { color: #2c3e50; }
                        .summary-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
                        .stat-card { background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; text-align: center; }
                        .stat-number { font-size: 2em; font-weight: bold; color: #007bff; }
                        .print-btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 0; }
                        @media print { .no-print { display: none; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Skills Assessment Analysis Report</h1>
                        <p><strong>Generated on:</strong> ${new Date().toLocaleDateString()}</p>
                        <p><strong>Team Size:</strong> ${matrix.totalEmployees} members</p>
                        <p><strong>Assessment Completion:</strong> ${matrix.completionRate}%</p>
                        <button class="print-btn no-print" onclick="window.print()">Print Report</button>
                    </div>
                    
                    <div class="summary-stats">
                        <div class="stat-card">
                            <div class="stat-number">${matrix.totalSkills}</div>
                            <div>Skills Assessed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${matrix.strengths.length}</div>
                            <div>Team Strengths</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${matrix.gaps.length}</div>
                            <div>Critical Gaps</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${matrix.expertCount}</div>
                            <div>Expert Ratings</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2>Executive Summary</h2>
                        <p>This comprehensive analysis evaluates ${matrix.totalAssessments} individual skill assessments across ${matrix.totalSkills} competencies covering technical expertise, software proficiency, and leadership capabilities.</p>
                        
                        <h3>Key Findings:</h3>
                        <ul>
                            <li><strong>Assessment Participation:</strong> ${matrix.completionRate}% of team members have completed their assessments</li>
                            <li><strong>Team Strengths:</strong> ${matrix.strengths.length > 0 ? matrix.strengths.join(', ') : 'Assessment data needed'}</li>
                            <li><strong>Development Areas:</strong> ${matrix.gaps.length > 0 ? matrix.gaps.join(', ') : 'No critical gaps identified'}</li>
                            <li><strong>Training Priority:</strong> ${matrix.trainingPriority}</li>
                            <li><strong>Training Requests:</strong> ${matrix.trainingRequestCount} skills flagged for training</li>
                        </ul>
                    </div>
                    
                    <div class="section">
                        <h2>Training Requests Summary</h2>
                        ${matrix.trainingRequestsSummary}
                    </div>
                    
                    <div class="section">
                        <h2>Detailed Analysis by Category</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Skill Category</th>
                                    <th>Expert</th>
                                    <th>Advanced</th>
                                    <th>Intermediate</th>
                                    <th>Beginner</th>
                                    <th>None</th>
                                    <th>Not Assessed</th>
                                    <th>Risk Level</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${matrix.categoryBreakdown.map(cat => `
                                    <tr>
                                        <td><strong>${cat.category}</strong></td>
                                        <td>${cat.expert}</td>
                                        <td>${cat.advanced}</td>
                                        <td>${cat.intermediate}</td>
                                        <td>${cat.beginner}</td>
                                        <td>${cat.none}</td>
                                        <td>${cat.notAssessed}</td>
                                        <td class="risk-${cat.risk.toLowerCase()}">${cat.risk}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="section">
                        <h2>Individual Skill Breakdown</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Skill</th>
                                    <th>Expert</th>
                                    <th>Advanced</th>
                                    <th>Intermediate</th>
                                    <th>Beginner</th>
                                    <th>None</th>
                                    <th>Coverage</th>
                                    <th>Priority</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${matrix.skillBreakdown.map(skill => `
                                    <tr>
                                        <td>${skill.name}</td>
                                        <td>${skill.expert}</td>
                                        <td>${skill.advanced}</td>
                                        <td>${skill.intermediate}</td>
                                        <td>${skill.beginner}</td>
                                        <td>${skill.none}</td>
                                        <td>${skill.coverage}%</td>
                                        <td class="risk-${skill.priority.toLowerCase()}">${skill.priority}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="section">
                        <h2>Strategic Recommendations</h2>
                        
                        <h3>🚨 Immediate Actions (0-3 months):</h3>
                        ${matrix.recommendations.immediate.map(rec => `<div class="skill-gap">• ${rec}</div>`).join('')}
                        
                        <h3>📈 Medium-term Development (3-12 months):</h3>
                        ${matrix.recommendations.mediumTerm.map(rec => `<div class="strength">• ${rec}</div>`).join('')}
                        
                        <h3>🎯 Long-term Strategic Goals (12+ months):</h3>
                        ${matrix.recommendations.longTerm.map(rec => `<div class="strength">• ${rec}</div>`).join('')}
                    </div>
                    
                    <div class="section">
                        <h2>Team Development Priorities</h2>
                        ${matrix.individualRecommendations.map(person => `
                            <div style="border-left: 4px solid #007bff; padding-left: 15px; margin-bottom: 20px;">
                                <h4>${person.name} (${person.role})</h4>
                                <p><strong>Assessment Status:</strong> ${person.status}</p>
                                <p><strong>Key Strengths:</strong> ${person.strengths.length > 0 ? person.strengths.join(', ') : 'Assessment pending'}</p>
                                <p><strong>Development Areas:</strong> ${person.developmentAreas.length > 0 ? person.developmentAreas.join(', ') : 'Assessment pending'}</p>
                                <p><strong>Training Requests:</strong> ${person.trainingRequests.length > 0 ? person.trainingRequests.join(', ') : 'None'}</p>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="section">
                        <h2>Action Plan</h2>
                        <ol>
                            <li><strong>Complete Outstanding Assessments</strong> - ${100 - matrix.completionRate}% of team members still need to complete their assessments</li>
                            <li><strong>Address Training Requests</strong> - Review and act on ${matrix.trainingRequestCount} training requests</li>
                            <li><strong>Implement Training Programs</strong> - Focus on identified gap areas and skill development priorities</li>
                            <li><strong>Establish Mentoring Networks</strong> - Pair expert-level team members with those developing skills</li>
                            <li><strong>Regular Review Cycles</strong> - Schedule quarterly skills assessment updates</li>
                            <li><strong>Track Progress Metrics</strong> - Monitor skill development and training effectiveness</li>
                        </ol>
                    </div>
                </body>
                </html>
            `;
            
            // Download as HTML file
            const blob = new Blob([reportHTML], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'skills_analysis_report_' + new Date().toISOString().split('T')[0] + '.html';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showNotification('Comprehensive analysis report generated!');
        }

        function analyzeOverviewData() {
            const allSkills = Object.values(skillsData).flatMap(cat => cat.skills);
            const totalEmployees = employees.length;
            const completedAssessments = Object.keys(assessmentData).length;
            const completionRate = Math.round((completedAssessments / totalEmployees) * 100);
            
            let totalAssessments = 0;
            let expertCount = 0;
            let trainingRequestCount = 0;
            const skillBreakdown = [];
            const categoryBreakdown = [];
            const trainingRequestsBySkill = {};
            
            // Analyze each skill
            allSkills.forEach(skill => {
                const ratings = employees.map(emp => 
                    assessmentData[emp.name] && assessmentData[emp.name][skill] || 'not-assessed'
                );
                
                const counts = {
                    expert: ratings.filter(r => r === 'Expert').length,
                    advanced: ratings.filter(r => r === 'Advanced').length,
                    intermediate: ratings.filter(r => r === 'Intermediate').length,
                    beginner: ratings.filter(r => r === 'Beginner').length,
                    none: ratings.filter(r => r === 'None').length,
                    notAssessed: ratings.filter(r => r === 'not-assessed').length
                };
                
                // Count training requests
                const skillTrainingRequests = employees.filter(emp => 
                    trainingRequests[emp.name] && trainingRequests[emp.name][skill]
                ).length;
                
                if (skillTrainingRequests > 0) {
                    trainingRequestsBySkill[skill] = skillTrainingRequests;
                    trainingRequestCount += skillTrainingRequests;
                }
                
                const assessed = totalEmployees - counts.notAssessed;
                const coverage = assessed > 0 ? Math.round(((counts.expert + counts.advanced) / assessed) * 100) : 0;
                
                let priority = 'Low';
                if (counts.expert === 0 && assessed > 0) priority = 'High';
                else if (coverage < 30) priority = 'Medium';
                
                skillBreakdown.push({
                    name: skill,
                    ...counts,
                    coverage,
                    priority
                });
                
                expertCount += counts.expert;
                totalAssessments += assessed;
            });
            
            // Analyze by category
            Object.entries(skillsData).forEach(([category, categoryData]) => {
                const skills = categoryData.skills;
                const categoryRatings = skills.flatMap(skill => 
                    employees.map(emp => 
                        assessmentData[emp.name] && assessmentData[emp.name][skill] || 'not-assessed'
                    )
                );
                
                const counts = {
                    expert: categoryRatings.filter(r => r === 'Expert').length,
                    advanced: categoryRatings.filter(r => r === 'Advanced').length,
                    intermediate: categoryRatings.filter(r => r === 'Intermediate').length,
                    beginner: categoryRatings.filter(r => r === 'Beginner').length,
                    none: categoryRatings.filter(r => r === 'None').length,
                    notAssessed: categoryRatings.filter(r => r === 'not-assessed').length
                };
                
                const assessed = categoryRatings.length - counts.notAssessed;
                const expertPercent = assessed > 0 ? (counts.expert / assessed) * 100 : 0;
                
                let risk = 'Low';
                if (expertPercent < 10) risk = 'High';
                else if (expertPercent < 25) risk = 'Medium';
                
                categoryBreakdown.push({
                    category,
                    ...counts,
                    risk
                });
            });
            
            // Generate training requests summary
            let trainingRequestsSummary = '<table style="width: 100%; margin-top: 10px;"><thead><tr><th>Skill</th><th>Requests</th><th>Employees</th></tr></thead><tbody>';
            Object.entries(trainingRequestsBySkill)
                .sort((a, b) => b[1] - a[1])
                .forEach(([skill, count]) => {
                    const requesters = employees
                        .filter(emp => trainingRequests[emp.name] && trainingRequests[emp.name][skill])
                        .map(emp => emp.name)
                        .join(', ');
                    trainingRequestsSummary += `<tr><td>${skill}</td><td>${count}</td><td style="font-size: 0.9em; color: #6c757d;">${requesters}</td></tr>`;
                });
            trainingRequestsSummary += '</tbody></table>';
            
            // Identify strengths, gaps, and priorities
            const strengths = skillBreakdown.filter(s => s.expert >= 2).map(s => s.name);
            const gaps = skillBreakdown.filter(s => s.expert === 0 && s.notAssessed < totalEmployees).map(s => s.name);
            const trainingPriority = Object.keys(trainingRequestsBySkill).length > 0 
                ? Object.entries(trainingRequestsBySkill).sort((a, b) => b[1] - a[1])[0][0]
                : 'Continue skill development across all areas';
            
            // Individual recommendations
            const individualRecommendations = employees.map(emp => {
                const empData = assessmentData[emp.name] || {};
                const empSkills = Object.entries(empData);
                const strengths = empSkills.filter(([_, rating]) => rating === 'Expert').map(([skill]) => skill);
                const developmentAreas = empSkills.filter(([_, rating]) => rating === 'Beginner' || rating === 'None').map(([skill]) => skill);
                const status = empSkills.length > 0 ? 'Completed' : 'Pending';
                const empTrainingRequests = trainingRequests[emp.name] || {};
                const requestedSkills = Object.entries(empTrainingRequests)
                    .filter(([_, requested]) => requested)
                    .map(([skill]) => skill);
                
                return {
                    name: emp.name,
                    role: emp.role,
                    status,
                    strengths: strengths.slice(0, 3),
                    developmentAreas: developmentAreas.slice(0, 3),
                    trainingRequests: requestedSkills.slice(0, 3)
                };
            });
            
            return {
                totalEmployees,
                totalSkills: allSkills.length,
                totalAssessments,
                completionRate,
                expertCount,
                trainingRequestCount,
                trainingRequestsSummary,
                skillBreakdown,
                categoryBreakdown,
                strengths: strengths.slice(0, 5),
                gaps: gaps.slice(0, 5),
                trainingPriority,
                individualRecommendations,
                recommendations: {
                    immediate: [
                        `Encourage ${totalEmployees - completedAssessments} team members to complete their assessments`,
                        `Review and address ${trainingRequestCount} training requests from team members`,
                        'Identify training resources for high-priority skill gaps',
                        'Establish peer learning groups for knowledge sharing'
                    ],
                    mediumTerm: [
                        'Develop structured training programs for identified gaps',
                        'Create mentoring relationships between experts and learners',
                        'Implement regular skills assessment cycles',
                        'Track progress on training requests and skill development'
                    ],
                    longTerm: [
                        'Build center of excellence for critical technical skills',
                        'Develop internal certification programs',
                        'Create comprehensive knowledge management system',
                        'Establish career progression paths based on skill development'
                    ]
                }
            };
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const bgColor = type === 'error' ? '#dc3545' : 'linear-gradient(135deg, #2E86AB, #A23B72)';
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(46, 134, 171, 0.3);
                z-index: 1000;
                font-weight: 600;
                transform: translateX(300px);
                transition: transform 0.3s ease;
                max-width: 300px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            
            // Hide and remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(300px)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Skills Management Functions
        function loadSkillsData() {
            try {
                const saved = localStorage.getItem('vfxSkillsStructure');
                if (saved) {
                    const loadedSkills = JSON.parse(saved);
                    console.log('Loaded skills structure from localStorage');
                    
                    // Migrate old format to new format if needed
                    if (loadedSkills && typeof loadedSkills === 'object') {
                        let needsMigration = false;
                        Object.values(loadedSkills).forEach(value => {
                            if (Array.isArray(value)) {
                                needsMigration = true;
                            }
                        });
                        
                        if (needsMigration) {
                            const migratedSkills = {};
                            Object.entries(loadedSkills).forEach(([category, skills]) => {
                                if (Array.isArray(skills)) {
                                    migratedSkills[category] = {
                                        skills: skills,
                                        type: guessSkillType(category)
                                    };
                                } else {
                                    migratedSkills[category] = skills;
                                }
                            });
                            skillsData = migratedSkills;
                            saveSkillsData();
                        } else {
                            skillsData = loadedSkills;
                        }
                    }
                } else {
                    console.log('Using default skills structure');
                    saveSkillsData();
                }
            } catch (error) {
                console.error('Could not load skills structure:', error);
            }
        }

        function guessSkillType(category) {
            const software = ['SOFTWARE', 'RENDER', 'TOOL', 'SYSTEM'];
            return software.some(word => category.toUpperCase().includes(word)) ? 'software' : 'department';
        }

        function saveSkillsData() {
            try {
                localStorage.setItem('vfxSkillsStructure', JSON.stringify(skillsData));
                console.log('Skills structure saved');
            } catch (error) {
                console.error('Could not save skills structure:', error);
            }
        }

        function updateSkillCategoryDropdown() {
            const dropdown = document.getElementById('skillCategory');
            if (!dropdown) return;
            
            dropdown.innerHTML = '<option value="">Select Category</option>';
            Object.keys(skillsData).forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                dropdown.appendChild(option);
            });
        }

        function addNewSkill() {
            const categorySelect = document.getElementById('skillCategory');
            const skillInput = document.getElementById('newSkillName');
            
            const category = categorySelect.value;
            const skillName = skillInput.value.trim();
            
            if (!category || !skillName) {
                showNotification('Please select a category and enter a skill name', 'error');
                return;
            }
            
            // Check if skill already exists in this category
            if (skillsData[category].skills.includes(skillName)) {
                showNotification('This skill already exists in the selected category', 'error');
                return;
            }
            
            // Add the skill
            skillsData[category].skills.push(skillName);
            saveSkillsData();
            
            // Clear form
            skillInput.value = '';
            
            // Update any active views
            if (currentEmployee) {
                populateAssessmentForm();
                loadCurrentRatings();
            }
            
            if (supervisorAccess) {
                populateOverview();
                updateCoverageVisualization();
            }
            
            showNotification(`Added "${skillName}" to ${category}`);
        }

        function addNewCategory() {
            const categoryInput = document.getElementById('newCategoryName');
            const typeSelect = document.getElementById('newCategoryType');
            const categoryName = categoryInput.value.trim().toUpperCase();
            const categoryType = typeSelect.value;
            
            if (!categoryName) {
                showNotification('Please enter a category name', 'error');
                return;
            }
            
            if (skillsData[categoryName]) {
                showNotification('This category already exists', 'error');
                return;
            }
            
            // Add new category with empty skills array
            skillsData[categoryName] = {
                skills: [],
                type: categoryType
            };
            saveSkillsData();
            
            // Clear form and update dropdown
            categoryInput.value = '';
            updateSkillCategoryDropdown();
            
            showNotification(`Added new category: ${categoryName}`);
        }

        function exportSkills() {
            const skillsExport = JSON.stringify(skillsData, null, 2);
            const blob = new Blob([skillsExport], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'skills_structure_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showNotification('Skills structure exported successfully!');
        }

        function importSkills(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedSkills = JSON.parse(e.target.result);
                    
                    // Validate structure
                    if (typeof importedSkills !== 'object') {
                        throw new Error('Invalid skills structure');
                    }
                    
                    // Confirm import
                    const totalCategories = Object.keys(importedSkills).length;
                    const totalSkills = Object.values(importedSkills).reduce((sum, cat) => {
                        return sum + (cat.skills ? cat.skills.length : 0);
                    }, 0);
                    
                    if (confirm(`Import ${totalCategories} categories with ${totalSkills} total skills? This will replace current skills structure.`)) {
                        skillsData = importedSkills;
                        saveSkillsData();
                        updateSkillCategoryDropdown();
                        
                        // Refresh current views
                        if (currentEmployee) {
                            populateAssessmentForm();
                            loadCurrentRatings();
                        }
                        
                        if (supervisorAccess) {
                            populateOverview();
                            updateCoverageVisualization();
                        }
                        
                        showNotification('Skills imported successfully!');
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    showNotification('Failed to import skills: Invalid file format', 'error');
                }
            };
            
            reader.readAsText(file);
            event.target.value = ''; // Reset file input
        }

        // Employee Bulk Management Functions
        function exportEmployees() {
            // Create CSV content
            let csv = ['Name,Role,Password'];
            
            employees.forEach(emp => {
                csv.push(`"${emp.name}","${emp.role}","${emp.password || ''}"`);
            });
            
            const csvContent = csv.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'employees_export_' + new Date().toISOString().split('T')[0] + '.csv';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showNotification('Employees exported successfully!');
        }

        function exportEmployeeTemplate() {
            const template = 'Name,Role,Password\n"John Doe","CG Supervisor",""\n"Jane Smith","Lead Artist",""\n"Bob Johnson","Senior Artist",""';
            
            const blob = new Blob([template], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'employees_template.csv';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showNotification('Template downloaded! Fill it out and import.');
        }

        function importEmployees(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            if (file.name.endsWith('.json')) {
                reader.onload = function(e) {
                    try {
                        const importedEmployees = JSON.parse(e.target.result);
                        processImportedEmployees(importedEmployees);
                    } catch (error) {
                        console.error('JSON import error:', error);
                        showNotification('Failed to import: Invalid JSON format', 'error');
                    }
                };
                reader.readAsText(file);
            } else {
                // CSV import
                reader.onload = function(e) {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                    
                    if (!headers.includes('Name') || !headers.includes('Role')) {
                        showNotification('CSV must have Name and Role columns', 'error');
                        return;
                    }
                    
                    const nameIndex = headers.indexOf('Name');
                    const roleIndex = headers.indexOf('Role');
                    const passwordIndex = headers.indexOf('Password');
                    
                    const importedEmployees = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;
                        
                        // Parse CSV line (handle quoted values)
                        const values = line.match(/(".*?"|[^,]+)/g) || [];
                        const cleanValues = values.map(v => v.trim().replace(/^"|"$/g, ''));
                        
                        const name = cleanValues[nameIndex];
                        const role = cleanValues[roleIndex];
                        const password = passwordIndex >= 0 ? cleanValues[passwordIndex] : '';
                        
                        if (name && role) {
                            importedEmployees.push({ name, role, password });
                        }
                    }
                    
                    processImportedEmployees(importedEmployees);
                };
                reader.readAsText(file);
            }
            
            event.target.value = ''; // Reset file input
        }

        function processImportedEmployees(importedEmployees) {
            if (!Array.isArray(importedEmployees) || importedEmployees.length === 0) {
                showNotification('No valid employees found in file', 'error');
                return;
            }
            
            let added = 0;
            let updated = 0;
            
            importedEmployees.forEach(emp => {
                if (!emp.name || !emp.role) return;
                
                const existingIndex = employees.findIndex(e => 
                    e.name.toLowerCase() === emp.name.toLowerCase()
                );
                
                if (existingIndex >= 0) {
                    // Update existing employee
                    employees[existingIndex].role = emp.role;
                    if (emp.password) {
                        employees[existingIndex].password = emp.password;
                    }
                    updated++;
                } else {
                    // Add new employee
                    const newEmployee = {
                        name: emp.name,
                        role: emp.role,
                        password: emp.password || generatePassword(emp.name.split(' ')[0])
                    };
                    employees.push(newEmployee);
                    added++;
                }
            });
            
            saveEmployeesList();
            populateEmployeeGrid();
            
            if (supervisorAccess) {
                populateOverview();
                updateAnalytics();
                updateCoverageVisualization();
            }
            
            showNotification(`Import complete! Added: ${added}, Updated: ${updated}`);
        }

        // Quick Action Functions
        function reviewPendingAssessments() {
            const pendingReviews = employees.filter(emp => 
                trainingRequests[emp.name] && Object.values(trainingRequests[emp.name]).some(v => v === true)
            );
            
            if (pendingReviews.length === 0) {
                showNotification('No assessments need review');
                return;
            }
            
            let reviewHTML = '<h3>Assessments Needing Review</h3>';
            reviewHTML += '<div style="max-height: 400px; overflow-y: auto;">';
            
            pendingReviews.forEach(emp => {
                const requests = Object.entries(trainingRequests[emp.name])
                    .filter(([_, requested]) => requested)
                    .map(([skill]) => skill);
                
                reviewHTML += `
                    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h4>${emp.name} (${emp.role})</h4>
                        <p><strong>Training Requests:</strong></p>
                        <ul>${requests.map(skill => `<li>${skill}</li>`).join('')}</ul>
                    </div>
                `;
            });
            
            reviewHTML += '</div>';
            
            // Show in a modal or alert
            const modal = document.createElement('div');
            modal.className = 'skill-definitions-modal';
            modal.style.display = 'block';
            modal.innerHTML = reviewHTML + '<button class="btn" onclick="this.parentElement.remove()" style="margin-top: 20px;">Close</button>';
            
            const overlay = document.createElement('div');
            overlay.className = 'skill-definitions-overlay';
            overlay.style.display = 'block';
            overlay.onclick = () => {
                modal.remove();
                overlay.remove();
            };
            
            document.body.appendChild(overlay);
            document.body.appendChild(modal);
        }

        function setTeamGoals() {
            const goalSkills = prompt('Enter skills for team goals (comma-separated):');
            if (!goalSkills) return;
            
            const skills = goalSkills.split(',').map(s => s.trim());
            const targetLevel = prompt('Enter target level (Beginner/Intermediate/Advanced/Expert):');
            
            if (!targetLevel || !['Beginner', 'Intermediate', 'Advanced', 'Expert'].includes(targetLevel)) {
                showNotification('Invalid target level', 'error');
                return;
            }
            
            const deadline = prompt('Enter deadline (YYYY-MM-DD):');
            if (!deadline) return;
            
            teamGoals[new Date().toISOString()] = {
                skills,
                targetLevel,
                deadline,
                created: new Date().toISOString()
            };
            
            saveAssessmentData();
            showNotification('Team goals set successfully!');
        }

        function scheduleReassessment() {
            const days = prompt('Schedule reassessment in how many days?');
            if (!days || isNaN(days)) return;
            
            const reassessmentDate = new Date();
            reassessmentDate.setDate(reassessmentDate.getDate() + parseInt(days));
            
            localStorage.setItem('vfxReassessmentDate', reassessmentDate.toISOString());
            showNotification(`Reassessment scheduled for ${reassessmentDate.toLocaleDateString()}`);
        }

        function exportDepartmentReport() {
            generateReport();
        }

        function exportIndividualReports() {
            employees.forEach(emp => {
                if (assessmentData[emp.name]) {
                    generateIndividualReport(emp);
                }
            });
            showNotification(`Generated ${Object.keys(assessmentData).length} individual reports`);
        }

        function generateIndividualReport(employee) {
            const currentData = assessmentData[employee.name] || {};
            const history = assessmentHistory[employee.name] || [];
            const comments = assessmentComments[employee.name] || {};
            const training = trainingRequests[employee.name] || {};
            
            // Similar to exportPersonalReport but for each employee
            // (Implementation details omitted for brevity)
        }

        function backupAllData() {
            const backup = {
                version: '1.0',
                date: new Date().toISOString(),
                employees,
                skillsData,
                assessmentData,
                assessmentHistory,
                assessmentComments,
                trainingRequests,
                teamGoals
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'vfx_assessment_backup_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showNotification('Complete backup created successfully!');
        }

        function restoreBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    if (!backup.version || !backup.employees || !backup.skillsData) {
                        throw new Error('Invalid backup file');
                    }
                    
                    if (confirm('Restore from backup? This will replace ALL current data.')) {
                        // Restore all data
                        employees.length = 0;
                        backup.employees.forEach(emp => employees.push(emp));
                        
                        skillsData = backup.skillsData;
                        assessmentData = backup.assessmentData || {};
                        assessmentHistory = backup.assessmentHistory || {};
                        assessmentComments = backup.assessmentComments || {};
                        trainingRequests = backup.trainingRequests || {};
                        teamGoals = backup.teamGoals || {};
                        
                        // Save everything
                        saveEmployeesList();
                        saveSkillsData();
                        saveAssessmentData();
                        
                        // Refresh UI
                        populateEmployeeGrid();
                        updateSkillCategoryDropdown();
                        
                        if (supervisorAccess) {
                            populateOverview();
                            updateAnalytics();
                            updateCoverageVisualization();
                        }
                        
                        showNotification('Backup restored successfully!');
                    }
                } catch (error) {
                    console.error('Restore error:', error);
                    showNotification('Failed to restore backup: Invalid file', 'error');
                }
            };
            
            reader.readAsText(file);
            event.target.value = '';
        }

        // Skill definitions modal functions
        function showSkillDefinitions() {
            document.querySelector('.skill-definitions-overlay').style.display = 'block';
            document.getElementById('skillDefinitionsModal').style.display = 'block';
        }

        function hideSkillDefinitions() {
            document.querySelector('.skill-definitions-overlay').style.display = 'none';
            document.getElementById('skillDefinitionsModal').style.display = 'none';
        }

        // Initialize the application when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Touch/swipe support for mobile rating selection
        if ('ontouchstart' in window) {
            document.addEventListener('touchstart', function(e) {
                if (e.target.classList.contains('rating-btn')) {
                    e.target.dataset.touchStartX = e.touches[0].clientX;
                }
            });
            
            document.addEventListener('touchend', function(e) {
                if (e.target.classList.contains('rating-btn') && e.target.dataset.touchStartX) {
                    const touchEndX = e.changedTouches[0].clientX;
                    const touchStartX = parseFloat(e.target.dataset.touchStartX);
                    
                    if (Math.abs(touchEndX - touchStartX) < 10) {
                        e.target.click();
                    }
                    
                    delete e.target.dataset.touchStartX;
                }
            });
        }

        // Session timeout warning
        let sessionTimeout;
        function resetSessionTimeout() {
            clearTimeout(sessionTimeout);
            sessionTimeout = setTimeout(() => {
                if (userSession || supervisorAccess) {
                    if (confirm('Your session is about to expire. Do you want to continue?')) {
                        resetSessionTimeout();
                    } else {
                        logout();
                    }
                }
            }, 30 * 60 * 1000); // 30 minutes
        }

        document.addEventListener('click', resetSessionTimeout);
        document.addEventListener('keypress', resetSessionTimeout);
        resetSessionTimeout();
    </script>
</body>
</html>